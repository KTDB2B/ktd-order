<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>KUPEC TRADE</title>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>

<style>
body{
font-family: Arial;
background:#f5f5f5;
margin:0;
}

header{
background:#111;
color:white;
padding:20px;
text-align:center;
font-size:24px;
}

.container{
max-width:900px;
margin:auto;
padding:20px;
}

.product{
background:white;
padding:15px;
margin-bottom:10px;
border-radius:8px;
display:flex;
justify-content:space-between;
}
</style>
</head>

<body>

<header>KUPEC TRADE DISTRIBUTION</header>
  
<div style="padding:15px;background:#eee;display:flex;justify-content:space-between">
<div>Товаров: <b id="cartCount">0</b></div>
<button onclick="sendOrder()">Отправить заказ</button>
</div>
  
<div class="container" id="products"></div>

<script>

const supabaseClient = supabase.createClient(
"https://irjdqrdiocmzbiyijzni.supabase.co",
"sb_publishable_8J_23fisR7Oqmset3_A4RA__Cjr5Hhm"
)

let cart = {}

async function loadProducts(){

const { data, error } = await supabaseClient
.from("products")
.select("*")
.eq("is_active", true)
.order("sort_order", { ascending: true })

const container = document.getElementById("products")

container.innerHTML=""

data.forEach(p => {

container.innerHTML += `
<div class="product">
<div>
<b>${p.name}</b><br>
${p.volume} л<br>
${p.price} ₸
</div>

<div>
<button onclick="minus('${p.id}')">−</button>
<span id="q_${p.id}">0</span>
<button onclick="plus('${p.id}')">+</button>
</div>

</div>
`

})

}

function plus(id){

if(!cart[id]) cart[id]=0
cart[id]++

updateQty(id)

}

function minus(id){

if(!cart[id]) return
cart[id]--

if(cart[id] < 0) cart[id] = 0

updateQty(id)

}

function updateQty(id){

document.getElementById("q_"+id).innerText = cart[id] || 0
updateCart()

}

function updateCart(){

let total = 0

for(let id in cart){
total += cart[id]
}

document.getElementById("cartCount").innerText = total

}

function sendOrder(){

let text = "Заказ:%0A"

for(let id in cart){

let qty = cart[id]

if(qty > 0){
text += qty + " шт%0A"
}

}

window.open("https://wa.me/?text=" + text)

}

loadProducts()

</script>

</body>
</html>
